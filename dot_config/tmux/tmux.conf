# Install package manager
set -g @plugin 'tmux-plugins/tpm'

set -g @plugin 'christoomey/vim-tmux-navigator' # Enable navigating between nvim and tmux
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# change prefix to CTRL+e
# unbind-key C-b
# set -g prefix C-e
# bind-key C-e send-prefix

## Settings

# Make sure colors are 24bit
# set-option -sa terminal-overrides ",xterm*:Tc"
# set -ga terminal-overrides ",foot:RGB"
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*:Tc"

set-option -g focus-events on
set -s escape-time 0 # Keep neovim happy (And me sane)
set-option -g status-interval 5
set-option -g automatic-rename on
set-option -g automatic-rename-format '#{b:pane_current_path}'
set-window-option -g mode-keys vi # Use vi keybindings
set-window-option -g monitor-activity on
set -g mouse on # Enable mouse
set-option -g status-position bottom # Set bar on top
set -g history-limit 30000
set -g base-index 1 # Windows starts at index 1
setw -g pane-base-index 1 # Panes starts at index 1
set -g renumber-windows on # If a window is removed renumber all windows
set -g allow-passthrough on   # Allow programs in the pane to bypass tmux (e.g. for image preview)
set -g detach-on-destroy off    # Don't exit from tmux when closing a session
bind -T prefix s choose-tree -s -Z -K "#{?#{e|<:#{line},9},#{e|+:#{line},1},#{?#{e|<:#{line},36},M-#{a:#{e|+:97,#{e|-:#{line},10}}},}}" # make sessions start at index 1

# Plugin settings
set -g @continuum-restore 'on'
set -g @continuum-save-interval '0'

set -g @resurrect-processes 'vi vim nvim man less more tail top htop'

# Set prefix key
unbind C-b              # Unbind the default prefix key
set -g prefix C-Space   # Set new prefix key to Ctrl+Space

# key bindings
bind -n M-l next-window
bind -n M-h previous-window
unbind-key p
bind-key p paste-buffer

# Don't exit copy mode when dragging with mouse
# unbind -T copy-mode-vi MouseDragEnd1Pane

# use CTRL+prefix escape to enter copy mode
unbind [
bind Escape copy-mode

# Requires tmux 2.4+
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'V' send -X select-line
bind-key -T copy-mode-vi 'y' send -X copy-pipe-and-cancel "wl-copy"
bind-key -T copy-mode-vi 'C-v' send -X begin-selection \; send -X rectangle-toggle

# New window in same path
bind c new-window -c "#{pane_current_path}"

# Split keys
unbind %
bind | split-window -h -c "#{pane_current_path}"

unbind \"
bind - split-window -v -c "#{pane_current_path}"

# Use vim arrow keys to resize
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5

bind P swapp -t -1

# Use m key to maximize pane
bind -r m resize-pane -Z

# CTRL+prefix n/p
# bind-key -n M-j select-pane -U
# bind-key -n M-k select-pane -D
# cycle prev/next pane
# bind -n S-right select-pane -t :.+
# bind -n S-left select-pane -t :.-

bind r source-file ~/.config/tmux/tmux.conf \; display-message " Config reloaded..". # Reload config

# Set color scheme (Sort of catppuccin mocha)
green_soft="#a6e3a1"
dark_blue="#1e1e2e"
light_blue="#89b4fa"
light_grey="#313244"
light_orange="#fab387"
dark_text="#221913"
light_text="#eeeeee"
grey_text="#cdd6f4"

set -g status-position bottom
set -g status-justify centre
set -g status-bg ${dark_blue}
set -g status-fg ${grey_text}
set -g status-left-length 100
set -g status-left-style "fg=${light_grey},bg=${dark_blue}"
set -g status-left "#[fg=${green_soft},bold] ï’‰  #S #[fg=${light_grey},bold,bg=${dark_blue}] |"
set -g status-right ""
set -g window-status-current-format "#[bg=${light_orange},bold,fg=${dark_text}] #I #[bg=${dark_blue},bold,fg=${light_text}] #W#{?window_zoomed_flag,#[fg=${light_text}] ~,}"
set -g window-status-format "#[bg=${light_blue},fg=${dark_text}] #I #[bg=${dark_blue},fg=${grey_text}] #W "
set -g message-style "fg=${light_text},bg=${dark_blue}"
set -g mode-style "fg=${dark_text},bg=${light_blue}"
set -g pane-border-style "fg=${dark_blue}"
set -g pane-active-border-style "fg=${light_blue}"
set -g menu-selected-style "fg=${dark_text},bg=${light_blue}"
set -g menu-border-style "fg=${light_blue}"
 
# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
